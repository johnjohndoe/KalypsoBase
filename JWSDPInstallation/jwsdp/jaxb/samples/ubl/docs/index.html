<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<!-- $Id$ -->
<html>
<head>
<meta content=
"HTML Tidy for Cygwin (vers 1st February 2003), see www.w3.org"
name="generator">
<title>Processing a UBL Order Instance with JAXB-Generated
Classes</title>
<meta http-equiv="Content-Type" content=
"text/html; charset=us-ascii">
<link rel="stylesheet" type="text/css" href=
"../../../docs/style/default.css">
</head>
<body>
<h1>Processing a UBL Order Instance with JAXB-Generated
Classes</h1>
<p>Links on this page open their targets in a second window. If
clicking on a link seems not to do anything, that's probably
because that window is covered or minimized.</p>
<p>This sample processes a business order instance, as defined by
<a href=
"http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=ubl"
target="window_2">UBL</a> (Universal Business Language). It shows
how JAXB helps when developing applications for industry-standard
schema. The best thing is to start by running the sample,
especially since many of the links in this document refer to the
output.</p>
<h3>Running the Sample</h3>
<h4>Solaris/Unix</h4>
<blockquote><code>$ JWSDP_HOME=&lt;<i>Your Java WSDP 1.2
installation directory</i>&gt;</code><br>
<code>$ $JWSDP_HOME/apache-ant/bin/ant</code></blockquote>
<h4>Windows NT/2000/XP</h4>
<blockquote><code>&gt; set JWSDP_HOME=&lt;<i>Your Java WSDP 1.2
installation directory</i>&gt;</code><br>
<code>&gt; %JWSDP_HOME%\apache-ant\bin\ant</code></blockquote>
<p>This directory structure exists before running the project:</p>
<pre>
./0p70 ) Subset of the bundle obtained from
| |    ) http://oasis-open.org/committees/ubl/lcsc/0p70/UBL0p70.zip
| |
| +--- context-fig01.jpg          )
| +--- <a href="../0p70/index.html" target=
"window_2">index.html</a>                 )
| +--- methodology-fig03.jpg      ) UBL documentation
| +--- UBL0p70_ReleaseNotes.html  )
| +--- UBLlogo.jpg                )
| |
| +---/xml ) Instance documents
| |    |
| |    +-- OfficeSupplyOrderInstance.xml ) Order instance
| |                                      ) processed by
| |                                      ) this sample
| +---/<a href="../0p70/xsd" target=
"window_2">xsd</a> ) The UBL schema
|      |
|      +-- CoreComponentParameters.xsd
|      +-- CoreComponentTypes.xsd
|      +-- UBL_Library_0p70_DespatchAdvice.xsd
|      +-- UBL_Library_0p70_Invoice.xsd
|      +-- UBL_Library_0p70_Order.xsd
|      +-- UBL_Library_0p70_OrderCancellation.xsd
|      +-- UBL_Library_0p70_OrderResponse.xsd
|      +-- UBL_Library_0p70_OrderResponseSimple.xsd
|      +-- UBL_Library_0p70_ReceiptAdvice.xsd
|      +-- UBL_Library_0p70_Reusable.xsd
|
./build.xml
|
./docs
| |
| +--- index.html  )
| +--- output.html ) Sample-specific documentation
| +--- xjb.html    )
|
./src ) Application source code
| |
| +-- samples/ubl/report ) Application package
|                 |
|                 +----- <a href=
"../src/samples/ubl/report/PrintOrder.java" target=
"window_2">PrintOrder.java</a> ) Order printing
|                 |                      ) application
|                 |
|                 +-----/facade ) Code implementing the
|                        |      ) facade design pattern
|                        |
|                        +----- <a href=
"../src/samples/ubl/report/facade/AddressFacade.java" target=
"window_2">AddressFacade.java</a>
|                        +----- <a href=
"../src/samples/ubl/report/facade/OrderFacade.java" target=
"window_2">OrderFacade.java</a>
|                        +----- <a href=
"../src/samples/ubl/report/facade/OrderLineTypeFacade.java"
   target="window_2">OrderLineTypeFacade.java</a>
|
./ubl.xjb ) Binding customizations
</pre>
<p>Running the project creates the directories <code>classes</code>
and <code>docs/api</code>.</p>
<pre>
./classes
| |
| +------/org/oasis/ubl/commonaggregatetypes    )
| +------/org/oasis/ubl/corecomponentparameters )
| +------/org/oasis/ubl/corecomponenttypes      ) Java packages for
| +------/org/oasis/ubl/despatchadvice          ) code generated by
| +------/org/oasis/ubl/invoice                 ) processing UBL schema
| +------/org/oasis/ubl/order                   ) with xjc using custom-
| +------/org/oasis/ubl/ordercancellation       ) izations in ubl.xjb.
| +------/org/oasis/ubl/orderresponse           )
| +------/org/oasis/ubl/orderresponsesimple     )
| +------/org/oasis/ubl/receiptadvice           )
| |
| +------/samples/ubl/report                    ) Compiled application
| +------/samples/ubl/report/facade             ) code.
|
.<a href="../docs/api/index.html" target=
"window_2">/docs/api</a> ) Java documentation for the UBL bindings
</pre>
<h3>Interpreting the Output</h3>
<p>If this is the first time you've run the sample, you'll see
output similar to <a href="output.html" target="window_2">this</a>.
Here's what's happening in each step.</p>
<ul>
<li>UBL Schema gets compiled into Java (<a href="output.html#xjc"
target="window_2">xjc</a>) 
<p>The schema are in the <code><a href="../0p70/xsd" target=
"window_2">0p70/xsd</a></code> directory. Ant places the output in
the <code><a href="../classes" target="window_2">classes</a></code>
directory.</p>
<p><i>Binding customizations</i> get applied as part of the schema
compilation. Their main purpose is to package the code more
logically than if package names were derived from the schema
namespaces. These customizations are controlled by this
   <i><a href="xjb.html" target="window_2">external binding
   file</a></i>.</p></li>
<li>Generated Java code gets compiled (<a href=
"output.html#compile-generated" target=
"window_2">compile-generated</a>) 
<p>Ant places the output in the <code><a href="../classes"
   target="window_2">classes</a></code> directory.</p></li>
<li>PrintOrder application gets compiled (<a href=
"output.html#compile-printorder" target=
"window_2">compile-printorder</a>) 
<p>The next section discusses <code>PrintOrder</code> in more
detail.</p></li>
<li>Build the Javadoc (<a href="output.html#javadoc" target=
"window_2">javadoc</a>) 
<p><a href="../docs/api/index.html" target="window_2">Javadoc</a>
for the generated code and the PrintOrder application gets compiled
in this step.</p></li>
<li>Run the application (<a href="output.html#printorder"
   target="window_2">printorder</a>)</li></ul>
<h3>The PrintOrder Application</h3>
<code>PrintOrder</code> unmarshals a UBL order instance, does some
simple calculations, and prints a report to the screen.
<code>PrintOrder</code> is in the <code>samples.ubl.report</code>
package. It imports classes having the following functions. 
<ul>
<li>Classes implementing the Facade design pattern: 
<blockquote>
<pre>
import samples.ubl.report.facade.OrderFacade;
import samples.ubl.report.facade.OrderLineTypeFacade;
import samples.ubl.report.facade.AddressFacade;
</pre></blockquote></li>
<li>Classes for file i/o: 
<blockquote>
<pre>
import java.io.FileInputStream;
import java.io.IOException;
</pre></blockquote></li>
<li>Class for locale-sensitive number formatting: 
<blockquote>
<pre>
import java.text.NumberFormat;
</pre></blockquote></li>
<li>Class to handle default collection type: 
<blockquote>
<pre>
import java.util.List;
</pre></blockquote></li>
<li>Binding framework classes: 
<blockquote>
<pre>
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Unmarshaller;
</pre></blockquote></li>
<li>UBL-specific objects: 
<blockquote>
<pre>
import org.oasis.ubl.commonaggregatetypes.OrderLineType;
import org.oasis.ubl.order.Order;
</pre></blockquote></li></ul>
<p><code>PrintOrder</code>'s <code>main</code> method:</p>
<ul>
<li>Creates an <code>Unmarshaller</code>: 
<blockquote>
<pre>
JAXBContext jc =
    JAXBContext.newInstance("org.oasis.ubl.order:"
                            + "org.oasis.ubl.commonaggregatetypes");
Unmarshaller u = jc.createUnmarshaller();
</pre></blockquote></li>
<li>Unmarshals an order instance: 
<blockquote>
<pre>
Order order =
    (Order) u.unmarshal(new
                        FileInputStream("0p70/xml/"
                                        + "OfficeSupplyOrder"
                                        + "Instance.xml"));
</pre></blockquote></li>
<li>Calls private methods to print various parts of the order: 
<blockquote>
<pre>
OrderFacade of = new OrderFacade(order);

printLetterHead(of);
printDate(of);
printBuyer(of);
printLineItems(of);
</pre></blockquote></li></ul>
<p>The private methods in <code>PrintOrder</code> use the facade
objects to print the data as <code>Strings</code>. For example:</p>
<blockquote>
<pre>
private static void printLetterHead(OrderFacade <span style=
"color:red">order</span>) {
    AddressFacade <span style=
      "color:red">addr</span> = <span style="color:red">order</span>.getSellerAddress();
    System.out.println("         "
                       + <span style=
"color:red">order</span>.getSellerName()
                       + "\n         "
                       + <span style=
"color:red">addr</span>.getStreet()
                       + "\n         "
                       + <span style=
"color:red">addr</span>.getCity()
                       + ", "
                       + <span style=
"color:red">addr</span>.getState()
                       + "  "
                       + <span style=
"color:red">addr</span>.getZip());
}
</pre></blockquote>
<p>The facade design pattern provides a simpler, higher-level
interface. Typically, that's done to isolate an application from
the complexity of the underlying subsystems. Here, our principle
motivation is to isolate our application from changes to an
evolving schema. Since we just wanted to print a simple report, our
facades are read-only.</p>
<p>A look at <code>printBuyer()</code> in <code>PrintOrder</code>
shows that getting the name of the buyer contact (a person,
usually) is just a matter of calling <code>OrderFacade</code>'s
<code>getBuyerContact()</code> method:</p>
<blockquote>
<pre>
private static void printBuyer(OrderFacade order) {
    AddressFacade addr = order.getBuyerAddress();
    System.out.println("\nSold To: "
                       + order.<span style=
"color:red">getBuyerContact()</span>
                       + "\n         c/o "
                       + order.getBuyerName()
                       + "\n         "
                       + addr.getStreet()
                       + "\n         "
                       + addr.getCity()
                       + ", "
                       + addr.getState()
                       + "  "
                       + addr.getZip());
}
</pre></blockquote>
<p><code>getBuyerContact()</code> insulates our application from
potential changes in the schema.</p>
<blockquote>
<pre>
public String getBuyerContact() {
    BuyerPartyType party = <span style=
"color:red">order</span>.getBuyerParty();
    if (party != null) {
        if (party.getBuyerContact() != null) {
            return party.getBuyerContact().getName() != null
                ? party.getBuyerContact().getName().getValue() : null;
        }
    }
    return "";             
}
</pre></blockquote>
In this snippet, <span style="color:red"><code>order</code></span>
is a reference to <code>org.oasis.ubl.order.Order</code>, which is
bound to 
<blockquote>
<pre>
&lt;xsd:element name="Order" type="OrderType"/&gt;
</pre></blockquote>
in <code>UBL_Library_0p70_Order.xsd</code>. If that binding were to
change, for example, such that <code>order.getBuyerParty()</code>
returned, let's say, <code>PartyType</code>, we could make this
one-line change to <code>getBuyerContact()</code> without affecting
<code>PrintOrder</code>: 
<blockquote>
<pre>
(BuyerPartyType)party = order.getBuyerParty();
</pre></blockquote>
This pattern characterizes the other methods in
<code>OrderFacade</code> and the methods in
<code>OrderLineTypeFacade</code> and <code>AddressFacade</code>. 
<h3>Further Reading</h3>
<p>For more information about using <a href=
"http://java.sun.com/xml/jaxb/index.html" target=
"window_2">JAXB</a>, refer to the <a href=
"http://java.sun.com/webservices/tutorial.html" target=
"window_2">Java Web Services Tutorial</a>. For more information
about UBL, visit OASIS' <a href=
"http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=ubl"
target="window_2">Universal Business Language Technical
Committee</a> site.</p>
</body>
</html>
