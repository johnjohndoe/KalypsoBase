<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<plugin>
   <extension-point id="toolWizards" name="toolWizards" schema="schema/toolWizards.exsd"/>
   <extension
         point="org.eclipse.ui.importWizards">
      <wizard
            category="org.kalypso.ui.importwizards.kalypso"
            class="org.kalypso.gml.ui.commands.importgrid.RectifiedGridCoverageImportWizard"
            icon="icons/obj16/gridImport.gif"
            id="org.kalypso.gml.ui.wizard.imports.RectifiedGridCoverageImportWizard"
            name="Rasterdaten">
         <selection
               class="org.eclipse.core.resources.IContainer">
         </selection>
         <description>%org.kalypso.gml.ui.wizard.grid.RectifiedGridCoverageImportWizard.description</description>
      </wizard>
   </extension>
   <extension
         point="org.kalypso.core.catalogContribution">
      <catalogContribution
            class="org.kalypso.gml.ui.catalog.GmlFeatureTypeStyleCatalogContribution"
            name="GML Style Catalog"/>
   </extension>
   
   <extension point="org.eclipse.ui.commands">
      <command categoryId="org.kalypso.ogc.gml.map.category" description="%org.kalypso.ogc.gml.map.CoverageManagementCommand.description" id="org.kalypso.ogc.gml.map.CoverageManagementCommand" name="%org.kalypso.ogc.gml.map.CoverageManagementCommand.name" />
      <command id="org.kalypso.gml.ui.toolWizards" name="Tools..." description="Tools on the selected element"/>
   </extension>
   <extension point="org.eclipse.ui.commandImages">
      <image commandId="org.kalypso.ogc.gml.map.CoverageManagementCommand" icon="icons/obj16/manageCoverages.gif" />
      <image commandId="org.kalypso.gml.ui.toolWizards" icon="icons/obj16/tools_16.png"/>
   </extension>
   <extension point="org.eclipse.ui.handlers">
		<handler commandId="org.kalypso.ogc.gml.map.CoverageManagementCommand">
			<class class="org.kalypso.ogc.gml.map.widgets.SelectWidgetHandler">
				<parameter name="org.kalypso.ogc.gml.map.widgets.SelectWidgetCommand.widget" value="org.kalypso.gml.ui.map.CoverageManagementWidget" />
			</class>
			<enabledWhen>
				<and>
					<!--reference definitionId="mapContext" /-->
					<with variable="activeMapPanel">
						<test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.opengis.net/gml}_Coverage" />
					</with>
				</and>
			</enabledWhen>
		</handler>
          <handler commandId="org.kalypso.gml.ui.toolWizards" class="org.kalypso.gml.ui.tools.ToolWizardsHandler">
                <enabledWhen>
                   <with variable="selection">
                      <count value="+"/>
                   </with>
                </enabledWhen>
          </handler>
   </extension>
   <extension
         point="org.kalypso.core.themeInfo">
      <themeInfo
            class="org.kalypso.gml.ui.map.CoverageThemeInfo"
            id="org.kalypso.gml.ui.map.CoverageThemeInfo">
      </themeInfo>
   </extension>
	<extension point="org.eclipse.ui.menus">
		<menuContribution locationURI="toolbar:org.kalypso.ui.menus.mapToolbar?before=widgetAdditions">
			<command commandId="org.kalypso.ogc.gml.map.CoverageManagementCommand" style="radio" tooltip="%org.kalypso.ogc.gml.map.CoverageManagementCommand.description">
				<visibleWhen checkEnabled="false">
					<and>
						<with variable="activeEditorId">
							<equals value="org.kalypso.ui.editor.mapeditor.GisMapEditor" />
						</with>
						<!--reference definitionId="mapContext" /-->
						<with variable="activeMapPanel">
							<test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.opengis.net/gml}_Coverage" />
						</with>
					</and>
				</visibleWhen>
			</command>		
		</menuContribution>
		<menuContribution locationURI="menu:org.kalypso.ui.menus.mapMenu?before=widgetAdditions">
			<command commandId="org.kalypso.ogc.gml.map.CoverageManagementCommand" style="radio" tooltip="%org.kalypso.ogc.gml.map.CoverageManagementCommand.description">
				<visibleWhen checkEnabled="false">
					<and>
						<with variable="activeEditorId">
							<equals value="org.kalypso.ui.editor.mapeditor.GisMapEditor" />
						</with>
						<!--reference definitionId="mapContext" /-->
						<with variable="activeMapPanel">
							<test property="org.kalypso.ui.test.map.activeTheme.qname" value="{http://www.opengis.net/gml}_Coverage" />
						</with>
					</and>
				</visibleWhen>
			</command>		
		</menuContribution>
		
        <menuContribution locationURI="popup:org.eclipse.ui.popup.any?after=additions">
            <command commandId="org.kalypso.gml.ui.toolWizards" style="push">
                 <visibleWhen checkEnabled="true"/>
            </command>
        </menuContribution>
        
        <menuContribution locationURI="popup:org.kalypso.ui.views.mapView.outline?after=additions">
            <command commandId="org.kalypso.gml.ui.toolWizards" style="push"/>
        </menuContribution>
	</extension>

    <extension point="org.eclipse.core.expressions.propertyTesters">
       <propertyTester
             class="org.kalypso.gml.ui.extensions.FeatureSelectionTester"
             id="org.kalypso.gml.ui.propertyTester.features"
             namespace="org.kalypso.gml.ui.featureSelection"
             properties="isNotEmpty,hasGeometryOfType"
             type="org.eclipse.jface.viewers.ISelection">
       </propertyTester>
    </extension>

    <extension point="org.eclipse.core.expressions.definitions">
          <definition id="org.kalypso.gml.ui.definition.selectionHasFeatures">
             <with variable="selection">
                <test property="org.kalypso.gml.ui.featureSelection.isNotEmpty"/>
             </with>
          </definition>
          <definition
                id="org.kalypso.gml.ui.definition.selectionHasTins">
             <with
                   variable="selection">
                <test
                      property="org.kalypso.gml.ui.featureSelection.hasGeometryOfType"
                      value="org.kalypsodeegree.model.geometry.GM_TriangulatedSurface">
                </test>
             </with>
          </definition>
    </extension>
    <extension
          point="org.eclipse.ui.newWizards">
       <wizard
             canFinishEarly="false"
             category="org.kalypso.ui.newwizards.kalypso"
             class="org.kalypso.gml.ui.internal.shape.ShapeFileNewWizard"
             hasPages="true"
             icon="icons/obj16/file_shp.gif"
             id="org.kalypso.gml.ui.shape.ShapeFileNewWizard"
             name="Shape File">
            <description>Creates a new shape file</description>
            <selection class="org.eclipse.core.resources.IResource" />
       </wizard>
    </extension>
    <extension
          point="org.eclipse.ui.perspectiveExtensions">
       <perspectiveExtension
             targetID="org.kalypso.ui.perspectives.ModelerPerspectiveFactory">
          <newWizardShortcut
                id="org.kalypso.gml.ui.shape.ShapeFileNewWizard">
          </newWizardShortcut>
       </perspectiveExtension>
       <perspectiveExtension
             targetID="org.kalypso.model.wspm.ui.product.WspmPerspectiveFactory">
          <newWizardShortcut
                id="org.kalypso.gml.ui.shape.ShapeFileNewWizard">
          </newWizardShortcut>
       </perspectiveExtension>
    </extension>
    <extension
          point="org.kalypso.ui.exportWizards">
       <category
             id="shapeExportWizards"
             name="ESRI Shape"
             parentCategory="exportWizards">
       </category>
       <wizard
             category="exportWizards/shapeExportWizards"
             class="org.kalypso.gml.ui.commands.exportshape.ExportShapeWizard"
             icon="icons/obj16/exportShp.gif"
             id="org.kalypso.gml.ui.commands.exportshape.ExportShapeWizard"
             name="%org.kalypso.ui.views.outline.ShapeExport.name">
          <description>
             %org.kalypso.ui.views.outline.ShapeExport.description
          </description>
       </wizard>
       <wizard
             category="exportWizards/shapeExportWizards"
             class="org.kalypso.gml.ui.commands.exportshape.ExportTin2ShapeWizard"
             icon="icons/obj16/exportTin.gif"
             id="org.kalypso.gml.ui.commands.exportshape.ExportTin2ShapeWizard"
             name="%org.kalypso.gml.ui.commands.Tin2ShapeExport.name">
          <description>
             %org.kalypso.gml.ui.commands.Tin2ShapeExport.description
          </description>
       </wizard>
     <wizard
           category="exportWizards"
           class="org.kalypso.gml.ui.commands.exporthmo.ExportHMOWizard"
           id="org.kalypso.gml.ui.commands.exporthmo.ExportHMOWizard"
           icon="icons/obj16/exportHmo.gif"
           name="%org.kalypso.gml.ui.commands.exporthmo.ExportHMOWizard.name">
           <description>%org.kalypso.gml.ui.commands.exporthmo.ExportHMOWizard.description</description>
     </wizard>
     <wizard
           category="exportWizards"
           class="org.kalypso.gml.ui.commands.exportgrid.RectifiedGridCoverageExportWizard"
           id="org.kalypso.gml.ui.commands.exportgrid.RectifiedGridCoverageExportWizard"
           icon="icons/obj16/gridImport.gif"
           name="Raster exportieren">
           <description>Export das selektierte Coverage in eine externe Rasterdatei</description>
     </wizard>
    </extension>
    <extension
          point="org.kalypso.ui.importWizards">
       <wizard
             class="org.kalypso.gml.ui.commands.importgrid.AddRectifiedGridCoveragesWizard"
             id="org.kalypso.gml.ui.commands.importgrid.AddRectifiedGridCoveragesWizard"
             icon="icons/obj16/gridImport.gif"
             name="Raster importieren">
             <description>Importiert ein Raster als GML-Coverage</description>
       </wizard>
    </extension>
    <extension
          point="org.kalypso.contribs.eclipsercp.wizardEnablement">
       <wizardEnablement
             wizardID="org.kalypso.gml.ui.commands.exportshape.ExportShapeWizard">
          <enablement>
             <reference
                   definitionId="org.kalypso.gml.ui.definition.selectionHasFeatures">
             </reference>
          </enablement>
       </wizardEnablement>
       <wizardEnablement
             wizardID="org.kalypso.gml.ui.commands.exportshape.ExportTin2ShapeWizard">
          <enablement>
             <reference
                   definitionId="org.kalypso.gml.ui.definition.selectionHasTins">
             </reference>
          </enablement>
       </wizardEnablement>
       <wizardEnablement wizardID="org.kalypso.gml.ui.commands.exporthmo.ExportHMOWizard">
          <enablement>
               <with variable="selection">
                  <test property="org.kalypso.gml.ui.featureSelection.hasGeometryOfType" value="org.kalypsodeegree.model.geometry.GM_TriangulatedSurface"/>
               </with>
          </enablement>
       </wizardEnablement>
       <wizardEnablement wizardID="org.kalypso.gml.ui.commands.exportgrid.RectifiedGridCoverageExportWizard">
          <enablement>
            <with variable="selection">
               <iterate ifEmpty="false" operator="and">
                    <!-- FIXME: should be more flexible about the selection; see Tin Export for a better example -->
                  <test
                        forcePluginActivation="false"
                        property="org.kalypso.core.qname"
                        value="{http://www.opengis.net/gml}_Coverage">
                  </test>
               </iterate>
            </with>
          </enablement>
       </wizardEnablement>
       <wizardEnablement wizardID="org.kalypso.gml.ui.commands.importgrid.AddRectifiedGridCoveragesWizard">
          <enablement>
            <with variable="selection">
               <iterate ifEmpty="false" operator="and">
                  <test
                        forcePluginActivation="false"
                        property="org.kalypso.core.qname"
                        value="{org.kalypso.gml.common.coverage}CoverageCollection">
                  </test>
               </iterate>
            </with>
          </enablement>
       </wizardEnablement>
    </extension>
    <extension
          point="org.kalypso.gml.ui.toolWizards">
       <category
             id="toolWizards"
             name="Tool Wizards">
       </category>
    </extension>
</plugin>
